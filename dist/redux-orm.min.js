!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ReduxOrm",[],t):"object"==typeof exports?exports.ReduxOrm=t():e.ReduxOrm=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=41)}([function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t,n){var r=n(14),s=n(15),o=n(16);e.exports=function(e){return r(e)||s(e)||o()}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(33),s=n(36),o=n(4);e.exports=function(e,t){var n={};return t=o(t,3),s(e,function(e,s,o){r(n,s,t(e,s,o))}),n}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){var r=n(20),s=n(4),o=n(21),i=n(22),a=n(23),u=n(24),c=n(8);e.exports=function(e,t,n){var l=-1;t=r(t.length?t:[c],a(s));var d=o(e,function(e,n,s){return{criteria:r(t,function(t){return t(e)}),index:++l,value:e}});return i(d,function(e,t){return u(e,t,n)})}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(17),s=n(18),o=n(4),i=n(6),a=n(19);e.exports=function(e,t){return(i(e)?r:s)(e,a(o(t,3)))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,s=0,o=[];++n<r;){var i=e[n];t(i,n,e)&&(o[s++]=i)}return o}},function(e,t,n){var r=n(7),s=n(6);e.exports=function(e,t,n,o){return null==e?[]:(s(t)||(t=null==t?[]:[t]),s(n=o?void 0:n)||(n=null==n?[]:[n]),r(e,t,n))}},function(e,t,n){var r=n(27),s=n(7),o=n(28),i=n(32),a=o(function(e,t){if(null==e)return[];var n=t.length;return n>1&&i(e,t[0],t[1])?t=[]:n>2&&i(t[0],t[1],t[2])&&(t=[t[0]]),s(e,r(t,1),[])});e.exports=a},function(e,t,n){"use strict";function r(e,t){return e===t}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,n=null,s=null;return function(){return function(e,t,n){if(null===t||null===n||t.length!==n.length)return!1;for(var r=t.length,s=0;s<r;s++)if(!e(t[s],n[s]))return!1;return!0}(t,n,arguments)||(s=e.apply(null,arguments)),n=arguments,s}}function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];var i=0,a=r.pop(),u=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(e){return"function"==typeof e})){var n=t.map(function(e){return typeof e}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return t}(r),c=e.apply(void 0,[function(){return i++,a.apply(null,arguments)}].concat(n)),l=s(function(){for(var e=[],t=u.length,n=0;n<t;n++)e.push(u[n].apply(null,arguments));return c.apply(null,e)});return l.resultFunc=a,l.recomputations=function(){return i},l.resetRecomputations=function(){return i=0},l}}t.__esModule=!0,t.defaultMemoize=s,t.createSelectorCreator=o,t.createStructuredSelector=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;if("object"!=typeof e)throw new Error("createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);var n=Object.keys(e);return t(n.map(function(t){return e[t]}),function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t,r){return e[n[r]]=t,e},{})})};var i=t.createSelector=o(s)},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,s=0,o=[];++n<r;){var i=e[n];t(i,n,e)&&(o[s++]=i)}return o}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,s=0,o=[];++n<r;){var i=e[n];t(i,n,e)&&(o[s++]=i)}return o}},function(e,t){var n="Expected a function";e.exports=function(e){if("function"!=typeof e)throw new TypeError(n);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}},function(e,t){e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){var r=n(25);e.exports=function(e,t,n){for(var s=-1,o=e.criteria,i=t.criteria,a=o.length,u=n.length;++s<a;){var c=r(o[s],i[s]);if(c)return s>=u?c:c*("desc"==n[s]?-1:1)}return e.index-t.index}},function(e,t,n){var r=n(26);e.exports=function(e,t){if(e!==t){var n=void 0!==e,s=null===e,o=e==e,i=r(e),a=void 0!==t,u=null===t,c=t==t,l=r(t);if(!u&&!l&&!i&&e>t||i&&a&&c&&!u&&!l||s&&a&&c||!n&&c||!o)return 1;if(!s&&!i&&!l&&e<t||l&&n&&o&&!s&&!i||u&&n&&o||!a&&o||!c)return-1}return 0}},function(e,t){e.exports=function(){return!1}},function(e,t){e.exports=function(e){return e&&e.length?e[0]:void 0}},function(e,t,n){var r=n(8),s=n(29),o=n(31);e.exports=function(e,t){return o(s(e,t,r),e+"")}},function(e,t,n){var r=n(30),s=Math.max;e.exports=function(e,t,n){return t=s(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,a=s(o.length-t,0),u=Array(a);++i<a;)u[i]=o[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=o[i];return c[t]=n(u),r(e,this,c)}}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t){e.exports=function(e){return e}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(34);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){var r=n(35),s=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=s},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(37),s=n(39);e.exports=function(e,t){return e&&r(e,t,s)}},function(e,t,n){var r=n(38)();e.exports=r},function(e,t){e.exports=function(e){return function(t,n,r){for(var s=-1,o=Object(t),i=r(t),a=i.length;a--;){var u=i[e?a:++s];if(!1===n(o[u],u,o))break}return t}}},function(e,t,n){var r=n(40)(Object.keys,Object);e.exports=r},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),o=n(5),i=n.n(o),a=n(3),u=n.n(a),c=n(2),l=n.n(c);function d(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function f(e){return function t(n){return 0===arguments.length||d(n)?t:e.apply(this,arguments)}}function h(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,s){return t.apply(this,arguments)};case 5:return function(e,n,r,s,o){return t.apply(this,arguments)};case 6:return function(e,n,r,s,o,i){return t.apply(this,arguments)};case 7:return function(e,n,r,s,o,i,a){return t.apply(this,arguments)};case 8:return function(e,n,r,s,o,i,a,u){return t.apply(this,arguments)};case 9:return function(e,n,r,s,o,i,a,u,c){return t.apply(this,arguments)};case 10:return function(e,n,r,s,o,i,a,u,c,l){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}var p=function(e){return function t(n,r){switch(arguments.length){case 0:return t;case 1:return d(n)?t:f(function(t){return e(n,t)});default:return d(n)&&d(r)?t:d(n)?f(function(t){return e(t,r)}):d(r)?f(function(t){return e(n,t)}):e(n,r)}}}(function(e,t){return 1===e?f(t):h(e,function e(t,n,r){return function(){for(var s=[],o=0,i=t,a=0;a<n.length||o<arguments.length;){var u;a<n.length&&(!d(n[a])||o>=arguments.length)?u=n[a]:(u=arguments[o],o+=1),s[a]=u,d(u)||(i-=1),a+=1}return i<=0?r.apply(this,s):h(i,e(t,s,r))}}(e,[],t))}),m=f(function(e){return p(e.length,e)}),y={"@@functional/placeholder":!0};function g(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}var b="@@_______immutableOpsOwnerID";function w(e,t){return!!t&&e[b]===t}var v="function"==typeof Symbol?function(){return Symbol("ownerID")}:function(){return{}};function M(e,t){return t&&function(e,t){Object.defineProperty(e,b,{value:t,configurable:!0,enumerable:!1})}(e,t),e}function O(e){return e instanceof Array?e:[e]}var x=".";function N(e){return"string"==typeof e?-1===e.indexOf(x)?[e]:e.split(x):e}function S(e,t,n){return n[e]=t,n}function k(e,t,n){var r=O(t);return e?r.forEach(function(t){g(t,function(t,r){var s;e&&n.hasOwnProperty(r)?(s="object"===l()(t)?k(e,[t],n[r]):t,n[r]=s):n[r]=t})}):Object.assign.apply(Object,[n].concat(u()(r))),n}var _=k.bind(null,!1),j=k.bind(null,!0);function E(e,t){return O(e).forEach(function(e){delete t[e]}),t}function F(e,t,n){return e[n]!==t[n]}function A(e,t,n,r){if(w(r,t))return k(e,n,r);var s=O(n),o=!1,i=r,a=function(){o||(o=!0,M(i=Object.assign({},r),t))};return s.forEach(function(n){g(n,function(s,o){if(e&&r.hasOwnProperty(o)){var u=i[o];if("object"===l()(s)&&!(s instanceof Array)){if(F(i,n,o)){var c=A(e,t,s,u);c!==u&&(a(),i[o]=c)}return!0}}F(i,n,o)&&(a(),i[o]=s)})}),i}var D=A.bind(null,!0);function I(e,t,n,r){if(w(r,e))return S(t,n,r);if(r[t]===n)return r;var s=function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t}(r);return s[t]=n,M(s,e),s}function T(e,t){for(var n=0,r=0;n<t.length;){e(t[n],r)?n++:t.splice(n,1),r++}return t}function C(e,t,n,r){var s=O(n);return r.splice.apply(r,[e,t].concat(u()(s))),r}function R(e,t,n){return C(e,0,t,n)}function $(e,t,n,r,s){if(w(s,e))return C(t,n,r,s);var o=O(r),i=s.slice();return M(i,e),i.splice.apply(i,[t,n].concat(u()(o))),i}function P(e,t,n,r){return w(r,e)?R(t,n,r):$(e,t,0,n,r)}var B={merge:A.bind(null,!1),deepMerge:D,omit:function(e,t,n){if(w(n,e))return E(t,n);var r=O(t).filter(function(e){return n.hasOwnProperty(e)});if(0===r.length)return n;var s=Object.assign({},n);return r.forEach(function(e){delete s[e]}),M(s,e),s},setIn:function(e,t,n,r){var s=N(t),o=function(e,t){for(var n=N(e),r=t,s=0;s<n.length;s++){var o=r[n[s]];if(s===n.length-1)return o;if("object"!==l()(o))return;r=o}}(s,r);if(n===o)return r;var i,a=s.length,u=i=w(r,e)?r:Object.assign(M({},e),r);return s.forEach(function(t,r){if(r!==a-1){var o=i[t],u=l()(o);if("object"!==u){if("undefined"===u){var c=M({},e);return i[t]=c,void(i=c)}var d="".concat(s[r-1],".").concat(t);throw new Error("A non-object value was encountered when traversing setIn path at ".concat(d,"."))}if(w(o,e))i=o;else{var f=M({},e);i[t]=Object.assign(f,o),i=f}}else i[t]=n}),u},insert:P,push:function(e,t,n){return P(e,n.length,t,n)},filter:function(e,t,n){if(w(n,e))return T(t,n);var r=n.filter(t);return r.length===n.length?n:(M(r,e),r)},splice:$,set:function(e,t,n,r){if(function(e){return e&&"object"===l()(e)&&"number"==typeof e.length&&e.length>=0&&e.length%1==0}(r))return I(e,t,n,r);if(w(r,e))return S(t,n,r);if(r[t]===n)return r;var s=Object.assign({},r);return M(s,e),s[t]=n,s}},U={merge:_,deepMerge:j,omit:E,setIn:function(e,t,n){for(var r=N(e),s=r.length,o=!1,i=0,a=n,u=r[i];!o;)if(i===s-1)a[u]=t,o=!0;else{var c=l()(a[u]);if("undefined"===c){var d={};M(d,null),a[u]=d}else if("object"!==c){var f="".concat(r[i-1],".").concat(u);throw new Error("A non-object value was encountered when traversing setIn path at ".concat(f,"."))}a=a[u],u=r[++i]}return n},insert:R,push:function(e,t){var n=O(e);return t.push.apply(t,u()(n)),t},filter:T,splice:C,set:S};var q=function(){var e=Object.assign({},B);g(e,function(t,n){e[n]=m(t.bind(null,null))});var t=Object.assign({},U);g(t,function(e,n){t[n]=m(e)});var n=Object.assign({},B);return g(n,function(e,t){n[t]=m(e)}),Object.assign(e,{mutable:t,batch:n,batched:function(e,t){var n,r;"function"==typeof e?(r=e,n=v()):(n=e,r=t);var s=Object.assign({},B);return g(s,function(e,t){s[t]=m(e.bind(null,n))}),r(s)},__:y,getBatchToken:v})}();const V="REDUX_ORM_UPDATE",Q="REDUX_ORM_DELETE",L="REDUX_ORM_CREATE",X="REDUX_ORM_FILTER",Y="REDUX_ORM_EXCLUDE",z="SUCCESS";function H(e){return("function"==typeof console.warn?console.warn.bind(console):console.log.bind(console))(e)}function G(e,t){return e+function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(t)}function K(e){return`from${e}Id`}function J(e){return`to${e}Id`}function W(e){return function(...t){return this.getQuerySet()[e](...t)}}function Z(e){return function(){return this.getQuerySet()[e]}}function ee(e,t){const n=t.sharedMethods.slice();!function(e,t){let n=e;for(;n!==Function.prototype;)t(n),n=Object.getPrototypeOf(n)}(t,t=>{for(let r=0;r<n.length;r++){let s=!1;const o=n[r],i=Object.getOwnPropertyDescriptor(t.prototype,o);void 0!==i&&(void 0!==i.get?(i.get=Z(o),Object.defineProperty(e,o,i),s=!0):"function"==typeof i.value&&(e[o]=W(o),s=!0)),s&&n.splice(r--,1)}})}function te(e){return null!==e&&void 0!==e&&"function"==typeof e.getId?e.getId():e}function ne(e,t){const n=e.filter(e=>t.includes(e)),r=e.filter(e=>!n.includes(e)),s=t.filter(e=>!n.includes(e));return r.length||s.length?{delete:r,add:s}:null}const{getBatchToken:re}=q;function se({type:e,payload:t},n){if(e!==X)return!1;if("object"!=typeof t)return!1;if(!t.hasOwnProperty(n))return!1;const r=t[n];return null!==r&&void 0!==r}const oe=function(){function e(e,t,n){Object.assign(this,{modelClass:e,clauses:t||[]}),this._opts=n}e.addSharedMethod=function(e){this.sharedMethods=this.sharedMethods.concat(e)};var t=e.prototype;return t._new=function(e,t){const n=Object.assign({},this._opts,t);return new this.constructor(this.modelClass,e,n)},t.toString=function(){return this._evaluate(),`QuerySet contents:\n    - ${this.rows.map(({id:e})=>this.modelClass.withId(e).toString()).join("\n    - ")}`},t.toRefArray=function(){return this._evaluate()},t.toModelArray=function(){const{modelClass:e}=this;return this._evaluate().map(t=>new e(t))},t.count=function(){return this._evaluate(),this.rows.length},t.exists=function(){return Boolean(this.count())},t.at=function(e){const{modelClass:t}=this,n=this._evaluate();if(e>=0&&e<n.length)return new t(n[e])},t.first=function(){return this.at(0)},t.last=function(){const e=this._evaluate();return this.at(e.length-1)},t.all=function(){return this._new(this.clauses)},t.filter=function(e){const t="object"==typeof e?i()(e,te):e,n={type:X,payload:t};return this._new(this.clauses.concat(n))},t.exclude=function(e){const t="object"==typeof e?i()(e,te):e,n={type:Y,payload:t};return this._new(this.clauses.concat(n))},t._evaluate=function(){if(void 0===this.modelClass.session)throw new Error([`Tried to query the ${this.modelClass.modelName} model's table without a session. `,"Create a session using `session = orm.session()` and use ",`\`session["${this.modelClass.modelName}"]\` for querying instead.`].join(""));if(!this._evaluated){const{session:e,modelName:t}=this.modelClass,n={table:t,clauses:this.clauses};this.rows=e.query(n).rows,this._evaluated=!0}return this.rows},t.orderBy=function(e,t){const n={type:"REDUX_ORM_ORDER_BY",payload:[e,t]};return this._new(this.clauses.concat(n))},t.update=function(e){const{session:t,modelName:n}=this.modelClass;t.applyUpdate({action:V,query:{table:n,clauses:this.clauses},payload:e}),this._evaluated=!1},t.delete=function(){const{session:e,modelName:t}=this.modelClass;this.toModelArray().forEach(e=>e._onDelete()),e.applyUpdate({action:Q,query:{table:t,clauses:this.clauses}}),this._evaluated=!1},t.map=function(){throw new Error("`QuerySet.prototype.map` has been removed. Call `.toModelArray()` or `.toRefArray()` first to map.")},t.forEach=function(){throw new Error("`QuerySet.prototype.forEach` has been removed. Call `.toModelArray()` or `.toRefArray()` first to iterate.")},s()(e,[{key:"withModels",get:function(){throw new Error("`QuerySet.prototype.withModels` has been removed. Use `.toModelArray()` or predicate functions that instantiate Models from refs, e.g. `new Model(ref)`.")}},{key:"withRefs",get:function(){H("`QuerySet.prototype.withRefs` has been deprecated. Query building operates on refs only now.")}}]),e}();oe.sharedMethods=["count","at","all","last","first","filter","exclude","orderBy","update","delete"];var ie=oe;var ae=function(){function e(e,t,n,r,s){this.schema=e,this.db=t,this.state=n||t.getEmptyState(),this.initialState=this.state,this.withMutations=Boolean(r),this.batchToken=s||v(),this.modelData={},this.models=e.getModelClasses(),this.sessionBoundModels=this.models.map(e=>{function t(){return Reflect.construct(e,arguments,t)}return Reflect.setPrototypeOf(t.prototype,e.prototype),Reflect.setPrototypeOf(t,e),Object.defineProperty(this,e.modelName,{get:()=>t}),t.connect(this),t})}var t=e.prototype;return t.getDataForModel=function(e){return this.modelData[e]||(this.modelData[e]={}),this.modelData[e]},t.markAccessed=function(e,t){const n=this.getDataForModel(e);n.accessedInstances||(n.accessedInstances={}),t.forEach(e=>{n.accessedInstances[e]=!0})},t.markFullTableScanned=function(e){this.getDataForModel(e).fullTableScanned=!0},t.markAccessedIndexes=function(e){e.forEach(([e,t,n])=>{const r=this.getDataForModel(e);r.accessedIndexes||(r.accessedIndexes={}),r.accessedIndexes[t]=[...r.accessedIndexes[t]||[],n]})},t.applyUpdate=function(e){const t=this._getTransaction(e),n=this.db.update(e,t,this.state),{status:r,state:s,payload:o}=n;if(r!==z)throw new Error(`Applying update failed with status ${r}. Payload: ${o}`);return this.state=s,o},t.query=function(e){const t=this.db.query(e,this.state);return this._markAccessedByQuery(e,t),t},t._getTransaction=function(e){const{withMutations:t}=this,{action:n}=e;let{batchToken:r}=this;return[V,Q].includes(n)&&(r=v()),{batchToken:r,withMutations:t}},t._markAccessedByQuery=function(e,t){const{table:n,clauses:r}=e,{rows:s}=t,{idAttribute:o}=this[n],i=new Set(s.map(e=>e[o])),a=[],u=r.some(e=>{if(!se(e,o))return!1;const t=e.payload[o];return null!==t&&(i.add(t),!0)}),{indexes:c}=this.state[n];r.forEach(e=>{Object.keys(c).forEach(t=>{if(!se(e,t))return;const r=e.payload[t];a.push([n,t,r])})}),u?this.markAccessed(n,i):a.length?this.markAccessedIndexes(a):this.markFullTableScanned(n)},t.getNextState=function(){return H("`Session.prototype.getNextState` has been deprecated. Access the `Session.prototype.state` property instead."),this.state},t.reduce=function(){throw new Error("`Session.prototype.reduce` has been removed. The Redux integration API is now decoupled from ORM and Session - see the 0.9 migration guide in the GitHub repo.")},s()(e,[{key:"accessedModelInstances",get:function(){return this.sessionBoundModels.filter(({modelName:e})=>this.getDataForModel(e).accessedInstances).reduce((e,{modelName:t})=>({...e,[t]:this.getDataForModel(t).accessedInstances}),{})}},{key:"fullTableScannedModels",get:function(){return this.sessionBoundModels.filter(({modelName:e})=>this.getDataForModel(e).fullTableScanned).map(({modelName:e})=>e)}},{key:"accessedIndexes",get:function(){return this.sessionBoundModels.filter(({modelName:e})=>this.getDataForModel(e).accessedIndexes).reduce((e,{modelName:t})=>({...e,[t]:this.getDataForModel(t).accessedIndexes}),{})}}]),e}(),ue=n(1),ce=n.n(ue);function le(e,t){return{get(){const{session:{[t]:n}}=this.getClass(),{[e]:r}=this._fields;return n.withId(r)},set(t){this.update({[e]:te(t)})}}}function de(e,t,n,r,s){return{get(){const{session:{[e]:o,[t]:i,[n]:a}}=this.getClass(),u=s?i:o,c=s?o:i,l=s?r.to:r.from,d=s?r.from:r.to,f=this.getId(),h=a.filter({[l]:f}),p=new Set(h.toRefArray().map(e=>e[d])),m=c.filter(e=>p.has(e[c.idAttribute]));return m.add=function(...e){const t=new Set(e.map(te)),n=h.filter(e=>t.has(e[d]));if(n.exists()){const e=n.toRefArray().map(e=>e[d]);throw new Error(`Tried to add already existing ${c.modelName} id(s) ${e} to the ${u.modelName} instance with id ${f}`)}t.forEach(e=>{a.create({[d]:e,[l]:f})})},m.clear=function(){h.delete()},m.remove=function(...e){const t=new Set(e.map(te)),n=h.filter(e=>t.has(e[d]));if(n.count()!==t.size){const e=n.toRefArray().map(e=>e[d]),r=[...t].filter(t=>!e.includes(t));throw new Error(`Tried to delete non-existing ${c.modelName} id(s) ${r} from the ${u.modelName} instance with id ${f}`)}n.delete()},m},set(){throw new Error("Tried setting a M2M field. Please use the related QuerySet methods add, remove and clear.")}}}let fe=function(e){function t(){return e.apply(this,arguments)||this}ce()(t,e);var n=t.prototype;return n.installForwardsDescriptor=function(){Object.defineProperty(this.model.prototype,this.fieldName,this.field.createForwardsDescriptor(this.fieldName,this.model,this.toModel,this.throughModel))},n.installForwardsVirtualField=function(){this.model.virtualFields[this.fieldName]=this.field.createForwardsVirtualField(this.fieldName,this.model,this.toModel,this.throughModel)},n.installBackwardsDescriptor=function(){if(Object.getOwnPropertyDescriptor(this.toModel.prototype,this.backwardsFieldName))throw new Error(function(e,t,n,r){return[`Reverse field ${r} already defined`,` on model ${n}. To fix, set a custom related`,` name on ${e}.${t}.`].join("")}(this.model.modelName,this.fieldName,this.toModel.modelName,this.backwardsFieldName));Object.defineProperty(this.toModel.prototype,this.backwardsFieldName,this.field.createBackwardsDescriptor(this.fieldName,this.model,this.toModel,this.throughModel))},n.installBackwardsVirtualField=function(){this.toModel.virtualFields[this.backwardsFieldName]=this.field.createBackwardsVirtualField(this.fieldName,this.model,this.toModel,this.throughModel)},t}(function(){function e(e){this.field=e.field,this.fieldName=e.fieldName,this.model=e.model,this.orm=e.orm,this.field.references(this.model)&&(this.field.toModelName="this")}return e.prototype.run=function(){this.field.installsForwardsDescriptor&&this.installForwardsDescriptor(),this.field.installsForwardsVirtualField&&this.installForwardsVirtualField(),this.field.installsBackwardsDescriptor&&this.installBackwardsDescriptor(),this.field.installsBackwardsVirtualField&&this.installBackwardsVirtualField()},s()(e,[{key:"toModel",get:function(){if(void 0===this._toModel){const{toModelName:e}=this.field;this._toModel=e?"this"===e?this.model:this.orm.get(e):null}return this._toModel}},{key:"throughModel",get:function(){if(void 0===this._throughModel){const e=this.field.getThroughModelName(this.fieldName,this.model);this._throughModel=e?this.orm.get(e):null}return this._throughModel}},{key:"backwardsFieldName",get:function(){return this.field.getBackwardsFieldName(this.model)}}]),e}()),he=function(){function e(){this.index=!1}var t=e.prototype;return t.getClass=function(){return this.constructor},t.references=function(e){return!1},t.getThroughModelName=function(e,t){return null},s()(e,[{key:"installerClass",get:function(){return fe}},{key:"installsForwardsDescriptor",get:function(){return!0}},{key:"installsForwardsVirtualField",get:function(){return!1}},{key:"installsBackwardsDescriptor",get:function(){return!1}},{key:"installsBackwardsVirtualField",get:function(){return!1}}]),e}(),pe=function(e){function t(t){var n;return(n=e.call(this)||this).opts=t||{},n.opts.hasOwnProperty("getDefault")&&(n.getDefault=n.opts.getDefault),n}return ce()(t,e),t.prototype.createForwardsDescriptor=function(e,t){return function(e){return{get(){return this._fields[e]},set(t){return this.set(e,t)},enumerable:!0,configurable:!0}}(e)},t}(he),me=function(e){function t(...t){var n;if(n=e.call(this)||this,1===t.length&&"object"==typeof t[0]){const e=t[0];n.toModelName=e.to,n.relatedName=e.relatedName,n.through=e.through,n.throughFields=e.throughFields,n.as=e.as}else[n.toModelName,n.relatedName]=t;return n}ce()(t,e);var n=t.prototype;return n.getBackwardsFieldName=function(e){return this.relatedName||function(e){return e.toLowerCase()+"Set"}(e.modelName)},n.createBackwardsVirtualField=function(e,t,n,r){return new(this.getClass())(t.modelName,e)},n.references=function(e){return this.toModelName===e.modelName},s()(t,[{key:"installsBackwardsVirtualField",get:function(){return!0}},{key:"installsBackwardsDescriptor",get:function(){return!0}},{key:"installerClass",get:function(){return function(e){function t(){return e.apply(this,arguments)||this}return ce()(t,e),t.prototype.installForwardsDescriptor=function(){Object.defineProperty(this.model.prototype,this.field.as||this.fieldName,this.field.createForwardsDescriptor(this.fieldName,this.model,this.toModel,this.throughModel))},t}(fe)}}]),t}(he),ye=function(e){function t(...t){var n;return(n=e.call(this,...t)||this).index=!0,n}ce()(t,e);var n=t.prototype;return n.createForwardsDescriptor=function(e,t,n,r){return le(e,n.modelName)},n.createBackwardsDescriptor=function(e,t,n,r){return function(e,t){return{get(){const{session:{[t]:n}}=this.getClass();return n.filter({[e]:this.getId()})},set(){throw new Error("Can't mutate a reverse many-to-one relation.")}}}(e,t.modelName)},t}(me),ge=function(e){function t(){return e.apply(this,arguments)||this}ce()(t,e);var n=t.prototype;return n.getDefault=function(){return[]},n.getThroughModelName=function(e,t){return this.through||G(t.modelName,e)},n.createForwardsDescriptor=function(e,t,n,r){return de(t.modelName,n.modelName,r.modelName,this.getThroughFields(e,t,n,r),!1)},n.createBackwardsDescriptor=function(e,t,n,r){return de(t.modelName,n.modelName,r.modelName,this.getThroughFields(e,t,n,r),!0)},n.createBackwardsVirtualField=function(e,t,n,r){return new(this.getClass())({to:t.modelName,relatedName:e,through:r.modelName,throughFields:this.getThroughFields(e,t,n,r)})},n.createForwardsVirtualField=function(e,t,n,r){return new(this.getClass())({to:n.modelName,relatedName:e,through:this.through,throughFields:this.getThroughFields(e,t,n,r)})},n.getThroughFields=function(e,t,n,r){if(this.throughFields){const[e,t]=this.throughFields,s=r.fields[e];return{to:s.references(n)?e:t,from:s.references(n)?t:e}}if(t.modelName===n.modelName)return{to:J(n.modelName),from:K(t.modelName)};const s=e=>Object.keys(r.fields).find(t=>r.fields[t].references(e));return{to:s(n),from:s(t)}},s()(t,[{key:"installsForwardsVirtualField",get:function(){return!0}}]),t}(me),be=function(e){function t(){return e.apply(this,arguments)||this}ce()(t,e);var n=t.prototype;return n.getBackwardsFieldName=function(e){return this.relatedName||e.modelName.toLowerCase()},n.createForwardsDescriptor=function(e,t,n,r){return function(...e){return le(...e)}(e,n.modelName)},n.createBackwardsDescriptor=function(e,t,n,r){return function(e,t){return{get(){const{session:{[t]:n}}=this.getClass();return n.get({[e]:this.getId()})},set(){throw new Error("Can't mutate a reverse one-to-one relation.")}}}(e,t.modelName)},t}(me);function we(e){return new pe(e)}function ve(...e){return new ye(...e)}function Me(...e){return new ge(...e)}function Oe(...e){return new be(...e)}function xe(e){const t=e.getClass(),{idAttribute:n,modelName:r}=t;return{table:r,clauses:[{type:X,payload:{[n]:e.getId()}}]}}const Ne=function(){function e(e){this._initFields(e)}var t=e.prototype;return t._initFields=function(e){const t=Object(e);this._fields={...t},Object.keys(t).forEach(e=>{e in this||Object.defineProperty(this,e,{get:()=>this._fields[e],set:t=>this.set(e,t),configurable:!0,enumerable:!0})})},e.toString=function(){return`ModelClass: ${this.modelName}`},e.options=function(){return{}},e.markAccessed=function(e){if(void 0===this._session)throw new Error([`Tried to mark rows of the ${this.modelName} model as accessed without a session. `,"Create a session using `session = orm.session()` and call ",`\`session["${this.modelName}"].markAccessed\` instead.`].join(""));this.session.markAccessed(this.modelName,e)},e.markFullTableScanned=function(){if(void 0===this._session)throw new Error([`Tried to mark the ${this.modelName} model as full table scanned without a session. `,"Create a session using `session = orm.session()` and call ",`\`session["${this.modelName}"].markFullTableScanned\` instead.`].join(""));this.session.markFullTableScanned(this.modelName)},e.markAccessedIndexes=function(e){if(void 0===this._session)throw new Error([`Tried to mark indexes for the ${this.modelName} model as accessed without a session. `,"Create a session using `session = orm.session()` and call ",`\`session["${this.modelName}"].markAccessedIndexes\` instead.`].join(""));this.session.markAccessedIndexes(e.map(([e,t])=>[this.modelName,e,t]))},e.connect=function(e){if(!(e instanceof ae))throw new Error("A model can only be connected to instances of Session.");this._session=e},e.getQuerySet=function(){const{querySetClass:e}=this;return new e(this)},e.invalidateClassCache=function(){this.isSetUp=void 0,this.virtualFields={}},e._getTableOpts=function(){return"function"==typeof this.backend?(H("`Model.backend` has been deprecated. Please rename to `.options`."),this.backend()):this.backend?(H("`Model.backend` has been deprecated. Please rename to `.options`."),this.backend):"function"==typeof this.options?this.options():this.options},e.create=function(e){if(void 0===this._session)throw new Error([`Tried to create a ${this.modelName} model instance without a session. `,"Create a session using `session = orm.session()` and call ",`\`session["${this.modelName}"].create\` instead.`].join(""));const t={...e},n={},r=Object.keys(this.fields),s=Object.keys(this.virtualFields);r.forEach(r=>{const s=this.fields[r],o=e.hasOwnProperty(r);if(s instanceof ge)o&&(n[r]=e[r],delete t[r]);else if(o){const n=e[r];t[r]=te(n)}else s.getDefault&&(t[r]=s.getDefault())}),s.forEach(r=>{if(!n.hasOwnProperty(r)){const s=this.virtualFields[r];e.hasOwnProperty(r)&&s instanceof ge&&(n[r]=e[r],delete t[r])}});const o=new this(this.session.applyUpdate({action:L,table:this.modelName,payload:t}));return o._refreshMany2Many(n),o},e.upsert=function(e){if(void 0===this.session)throw new Error([`Tried to upsert a ${this.modelName} model instance without a session. `,"Create a session using `session = orm.session()` and call ",`\`session["${this.modelName}"].upsert\` instead.`].join(""));const{idAttribute:t}=this;if(e.hasOwnProperty(t)){const n=e[t];if(this.idExists(n)){const t=this.withId(n);return t.update(e),t}}return this.create(e)},e.withId=function(e){return this.get({[this.idAttribute]:e})},e.idExists=function(e){return this.exists({[this.idAttribute]:e})},e.exists=function(e){if(void 0===this.session)throw new Error([`Tried to check if a ${this.modelName} model instance exists without a session. `,"Create a session using `session = orm.session()` and call ",`\`session["${this.modelName}"].exists\` instead.`].join(""));return Boolean(this._findDatabaseRows(e).length)},e.get=function(e){const t=this._findDatabaseRows(e);if(0===t.length)return null;if(t.length>1)throw new Error(`Expected to find a single row in \`${this.modelName}.get\`. Found ${t.length}.`);return new this(t[0])},t.getClass=function(){return this.constructor},t.getId=function(){return this._fields[this.getClass().idAttribute]},e._findDatabaseRows=function(e){const t={table:this.modelName};return e&&(t.clauses=[{type:X,payload:e}]),this.session.query(t).rows},t.toString=function(){const e=this.getClass();return`${e.modelName}: {${Object.keys(e.fields).map(t=>{if(e.fields[t]instanceof ge){return`${t}: [${this[t].toModelArray().map(e=>e.getId()).join(", ")}]`}return`${t}: ${this._fields[t]}`}).join(", ")}}`},t.equals=function(e){return function(e,t){let n=0;return Object.entries(Object(e)).forEach(([e,r])=>{if(!t.hasOwnProperty(e)||t[e]!==r)return!1;n++}),n===Object.keys(t).length}(this._fields,e._fields)},t.set=function(e,t){this.update({[e]:t})},t.update=function(e){const t=this.getClass();if(void 0===t.session)throw new Error([`Tried to update a ${t.modelName} model instance without a session. `,"You cannot call `.update` on an instance that you did not receive from the database."].join(""));const n={...e},{fields:r,virtualFields:s}=t,o={};for(const e in n){if(r.hasOwnProperty(e)){const t=r[e];t instanceof ye||t instanceof be?n[e]=te(n[e]):t instanceof ge&&(o[e]=n[e],delete n[e])}else if(s.hasOwnProperty(e)){s[e]instanceof ge&&(o[e]=n[e],delete n[e])}}const i={...this._fields,...n},a=new t(this._fields);a._initFields(i),a._refreshMany2Many(o);const u=Object.keys(o).every(e=>!ne(this[e],a[e])),c=this.equals(a);c||this._initFields(i),u||this._refreshMany2Many(o),c&&u||t.session.applyUpdate({action:V,query:xe(this),payload:n})},t.refreshFromState=function(){this._initFields(this.ref)},t.delete=function(){const e=this.getClass();if(void 0===e.session)throw new Error([`Tried to delete a ${e.modelName} model instance without a session. `,"You cannot call `.delete` on an instance that you did not receive from the database."].join(""));this._onDelete(),e.session.applyUpdate({action:Q,query:xe(this)})},t._refreshMany2Many=function(e){const t=this.getClass(),{fields:n,virtualFields:r,modelName:s}=t;Object.keys(e).forEach(o=>{const i=!n.hasOwnProperty(o),a=r[o],u=e[o];if(!Array.isArray(u))throw new TypeError(`Failed to resolve many-to-many relationship: ${s}[${o}] must be an array (passed: ${u})`);const c=u.map(te),l=[...new Set(c)];if(c.length!==l.length)throw new Error(`Found duplicate id(s) when passing "${c}" to ${t.modelName}.${o} value`);const d=a.through||G(t.modelName,o),f=t.session[d];let h,p;i?({from:p,to:h}=a.throughFields):({from:h,to:p}=a.throughFields);const m=ne(f.filter(e=>e[h]===this[t.idAttribute]).toRefArray().map(e=>e[p]),c);if(m){const{delete:e,add:t}=m;e.length>0&&this[o].remove(...e),t.length>0&&this[o].add(...t)}})},t._onDelete=function(){const{virtualFields:e}=this.getClass();for(const t in e){const n=e[t];if(n instanceof ge)this[t].clear();else if(n instanceof ye){const e=this[t];e.exists()&&e.update({[n.relatedName]:null})}else n instanceof be&&null!==this[t]&&(this[t][n.relatedName]=null)}},e.hasId=function(e){return console.warn("`Model.hasId` has been deprecated. Please use `Model.idExists` instead."),this.idExists(e)},t.getNextState=function(){throw new Error("`Model.prototype.getNextState` has been removed. See the 0.9 migration guide on the GitHub repo.")},s()(e,[{key:"ref",get:function(){const e=this.getClass();return e._findDatabaseRows({[e.idAttribute]:this.getId()})[0]}}],[{key:"idAttribute",get:function(){if(void 0===this._session)throw new Error([`Tried to get the ${this.modelName} model's id attribute without a session. `,"Create a session using `session = orm.session()` and access ",`\`session["${this.modelName}"].idAttribute\` instead.`].join(""));return this.session.db.describe(this.modelName).idAttribute}},{key:"session",get:function(){return this._session}},{key:"query",get:function(){return this.getQuerySet()}}]),e}();Ne.fields={id:we()},Ne.virtualFields={},Ne.querySetClass=ie;var Se=Ne,ke=n(9),_e=n.n(ke),je=n(10),Ee=n.n(je),Fe=n(11),Ae=n.n(Fe),De=n(12),Ie=n.n(De);const Te={idAttribute:"id",arrName:"items",mapName:"itemsById",fields:{}};var Ce=function(){function e(e){Object.assign(this,Te,e)}var t=e.prototype;return t.accessId=function(e,t){return e[this.mapName][t]},t.accessIds=function(e,t){const n=e[this.mapName];return t.map(e=>n[e])},t.idExists=function(e,t){return e[this.mapName].hasOwnProperty(t)},t.accessIdList=function(e){return e[this.arrName]},t.accessList=function(e){return this.accessIds(e,this.accessIdList(e))},t.getMaxId=function(e){return this.getMeta(e,"maxId")},t.setMaxId=function(e,t,n){return this.setMeta(e,t,"maxId",n)},t.nextId=function(e){return e+1},t.getEmptyState=function(){const e={[this.arrName]:[],[this.mapName]:{}},t=Object.keys(this.fields).filter(e=>e!==this.idAttribute).filter(e=>this.fields[e].index).reduce((e,t)=>({...e,[t]:{}}),{});return{...e,indexes:t,meta:{}}},t.setMeta=function(e,t,n,r){const{batchToken:s,withMutations:o}=e;if(o){return q.mutable.setIn(["meta",n],r,t)}return q.batch.setIn(s,["meta",n],r,t)},t.getMeta=function(e,t){return e.meta[t]},t.query=function(e,t){if(0===t.length)return this.accessList(e);const{idAttribute:n}=this,r=(t,s)=>{const{type:o,payload:i}=s;if(!t){if(se(s,n)){const t=i[n];return this.idExists(e,t)?[this.accessId(e,t)]:[]}if(o===X&&"object"==typeof i){const t=[],n=[];if(Object.entries(e.indexes).forEach(([e,r])=>{se(s,e)&&r.hasOwnProperty(i[e])&&(t.push(r[i[e]]),n.push(e))}),t.length){const o=t.pop(),a=t.reduce((e,t)=>{const n=new Set(t);return e.filter(Set.prototype.has,n)},o),u=Object.keys(i).reduce((e,t)=>(n.includes(t)||(e[t]=i[t]),e),{});return 0===Object.keys(u).length?this.accessIds(e,a):r(this.accessIds(e,a),{...s,payload:u})}}return r(this.accessList(e),s)}switch(o){case X:return Ee()(t,i);case Y:return _e()(t,i);case"REDUX_ORM_ORDER_BY":{const[e,n]=i;return Ae()(t,e,n)}default:return t}};return Ie()(t,e=>se(e,n)?1:function({type:e}){return[X,Y].includes(e)}(e)?2:3).reduce(r,void 0)},t.insert=function(e,t,n){const{batchToken:r,withMutations:s}=e,o=n.hasOwnProperty(this.idAttribute);let i=t;const[a,u]=function(e,t){let n,r,s=e;return void 0===s&&(s=-1),void 0===t?r=n=s+1:(n=Math.max(s+1,t),r=t),[n,r]}(this.getMaxId(t),n[this.idAttribute]);i=this.setMaxId(e,t,a);const c=o?n:q.batch.set(r,this.idAttribute,u,n),l=Object.keys(i.indexes).reduce((e,t)=>n.hasOwnProperty(t)?null===n[t]?e:(e.push([t,n[t]]),e):e,[]);if(s)return q.mutable.push(u,i[this.arrName]),q.mutable.set(u,c,i[this.mapName]),l.forEach(([e,t])=>{const n=i.indexes[e];n.hasOwnProperty(t)?q.mutable.push(u,n[t]):q.mutable.set(t,[u],n)}),{state:i,created:c};const d=q.batch.merge(r,l.reduce((e,[t,n])=>(e[t]=q.batch.merge(r,{[n]:q.batch.push(r,u,e[t][n]||[])},e[t]),e),{...i.indexes}),i.indexes);return{state:q.batch.merge(r,{[this.arrName]:q.batch.push(r,u,i[this.arrName]),[this.mapName]:q.batch.merge(r,{[u]:c},i[this.mapName]),indexes:d},i),created:c}},t.update=function(e,t,n,r){const{batchToken:s,withMutations:o}=e,i=o?q.mutable.set:q.batch.set(s),a=Object.keys(t.indexes).filter(e=>r.hasOwnProperty(e)),u=[],c=[],l=n.reduce((e,t)=>{const n=a.reduce((e,n)=>({...e,[n]:t[n]}),{}),l=(e=>{return(o?q.mutable.merge:q.batch.merge(s))(r,e)})(t),d=a.reduce((e,t)=>({...e,[t]:l[t]}),{}),f=l[this.idAttribute],h=i(f,l,e);return a.forEach(e=>{const{[e]:t}=n,{[e]:r}=d;t!==r&&(null!==t&&c.push([e,t,f]),null!==r&&u.push([e,r,f]))}),h},t[this.mapName]);let d=t.indexes;return o?(c.forEach(([e,t,n])=>{const r=d[e][t],s=r.indexOf(n);-1!==s&&q.mutable.splice(s,1,[],r)}),u.forEach(([e,t,n])=>{q.mutable.push(n,d[e][t])})):(u.length&&(d=q.batch.merge(s,u.reduce((e,[t,n,r])=>(e[t]=q.batch.merge(s,{[n]:q.batch.push(s,r,e[t][n]||[])},e[t]),e),{...d}),d)),c.length&&(d=q.batch.merge(s,c.reduce((e,[t,n,r])=>(e[t]=q.batch.merge(s,{[n]:q.batch.filter(s,e=>e!==r,e[t][n]||[])},e[t]),e),{...d}),d))),q.batch.merge(s,{[this.mapName]:l,indexes:d},t)},t.delete=function(e,t,n){const{batchToken:r,withMutations:s}=e,{arrName:o,mapName:i}=this,a=t[o],u=n.map(e=>e[this.idAttribute]);if(s)return u.forEach(e=>{const n=a.indexOf(e);-1!==n&&q.mutable.splice(n,1,[],a),q.mutable.omit(e,t[i])}),Object.values(t.indexes).forEach(e=>Object.values(e).forEach(e=>u.forEach(t=>{const n=e.indexOf(t);-1!==n&&q.mutable.splice(n,1,[],e)}))),t;const c=q.batch.merge(r,Object.entries(t.indexes).reduce((e,[t,n])=>(e[t]=q.batch.merge(r,Object.entries(n).reduce((e,[t,n])=>(e[t]=q.batch.filter(r,e=>!u.includes(e),n),e),{...e[t]}),e[t]),e),{...t.indexes}),t.indexes);return q.batch.merge(r,{[o]:q.batch.filter(r,e=>!u.includes(e),t[o]),[i]:q.batch.omit(r,u,t[i]),indexes:q.batch.merge(r,c,t.indexes)},t)},e}();function Re(e,t,n){const{table:r,clauses:s}=t;return{rows:e[r].query(n[r],s)}}function $e(e,t,n,r){const{action:s,payload:o}=t;let i,a,u;if(s===L){({table:i}=t);const s=e[i],c=r[i],l=s.insert(n,c,o);a=l.state,u=l.created}else{const{query:c}=t;({table:i}=c);const{rows:l}=Re(e,c,r),d=e[i],f=r[i];if(s===V)a=d.update(n,f,l,o),u=Re(e,c,r).rows;else{if(s!==Q)throw new Error(`Database received unknown update type: ${s}`);a=d.delete(n,f,l),u=l}}const c=function(e,t,n,r){const{batchToken:s,withMutations:o}=n;return o?(r[e]=t,r):q.batch.set(s,e,t,r)}(i,a,n,r);return{status:z,state:c,payload:u}}var Pe=function(e){const{tables:t}=e,n=Object.entries(t).reduce((e,[t,n])=>({...e,[t]:new Ce(n)}),{});return{getEmptyState:()=>Object.entries(n).reduce((e,[t,n])=>({...e,[t]:n.getEmptyState()}),{}),query:Re.bind(null,n),update:$e.bind(null,n),describe:e=>n[e]}},Be=n(13);const Ue=(e,t)=>e===t,qe=(e,t,n)=>t.every((t,r)=>n(t,e[r])),Ve=(e,t,n)=>{const{accessedInstances:r}=e;return Object.entries(r).every(([r,s])=>{if(e.ormState[r]===t[r])return!0;const{mapName:o}=n.getDatabase().describe(r),{[o]:i}=e.ormState[r],{[o]:a}=t[r];return((e,t,n)=>e.every(e=>t[e]===n[e]))(Object.keys(s),i,a)})},Qe=(e,t)=>{const{accessedIndexes:n}=e;return Object.entries(n).every(([n,r])=>Object.entries(r).every(([r,s])=>s.every(s=>e.ormState[n].indexes[r][s]===t[n].indexes[r][s])))},Le=(e,t)=>e.fullTableScannedModels.every(n=>e.ormState[n]===t[n]);function Xe(e,t=Ue,n){const r={result:null,args:null,ormState:null,fullTableScannedModels:[],accessedInstances:{},accessedIndexes:{}};return(...s)=>{const[o,...i]=s;if(r.args&&r.ormState&&qe(r.args,i,t)&&Le(r,o)&&Qe(r,o)&&Ve(r,o,n))return r.result;r.args=i;const a=n.session(o);r.ormState=o;const u=e(...[a,...i]);return r.result=u,r.accessedInstances=a.accessedModelInstances,r.accessedIndexes=a.accessedIndexes,r.fullTableScannedModels=a.fullTableScannedModels,u}}function Ye(e,t=function(e,t){e.sessionBoundModels.forEach(n=>{"function"==typeof n.reducer&&n.reducer(t,n,e)})}){return(n,r)=>{const s=e.session(n||e.getEmptyState());return t(s,r),s.state}}function ze(e,...t){return 1===t.length?Xe(t[0],void 0,e):Object(Be.createSelectorCreator)(Xe,void 0,e)(...t)}const He={createDatabase:Pe},Ge=["indexes","meta"];let Ke=function(){function e(e){const{createDatabase:t}=Object.assign({},He,e||{});this.createDatabase=t,this.registry=[],this.implicitThroughModels=[],this.installedFields={}}var t=e.prototype;return t.register=function(...e){e.forEach(e=>{if(void 0===e.modelName)throw new Error("A model was passed that doesn't have a modelName set");e.invalidateClassCache(),this.registerManyToManyModelsFor(e),this.registry.push(e)})},t.registerManyToManyModelsFor=function(e){const{fields:t}=e,n=e.modelName;Object.entries(t).forEach(([e,t])=>{if(!(t instanceof ge))return;let r;r="this"===t.toModelName?n:t.toModelName;const o=n===r,i=K(n),a=J(r);if(t.through){if(o&&!t.throughFields)throw new Error("Self-referencing many-to-many relationship at "+`"${n}.${e}" using custom `+`model "${t.through}" has no `+"throughFields key. Cannot determine which fields reference the instances partaking in the relationship.")}else{const t=function(e){function t(){return e.apply(this,arguments)||this}return ce()(t,e),t}(Se);t.modelName=G(n,e);const u=o?function(e){function t(){return e.apply(this,arguments)||this}return ce()(t,e),s()(t,[{key:"installsBackwardsVirtualField",get:function(){return!1}},{key:"installsBackwardsDescriptor",get:function(){return!1}}]),t}(ye):ye;t.fields={id:we(),[i]:new u(n),[a]:new u(r)},t.invalidateClassCache(),this.implicitThroughModels.push(t)}})},t.get=function(e){const t=this.registry.concat(this.implicitThroughModels),n=Object.values(t).find(t=>t.modelName===e);if(void 0===n)throw new Error(`Did not find model ${e} from registry.`);return n},t.getModelClasses=function(){return this._setupModelPrototypes(this.registry),this._setupModelPrototypes(this.implicitThroughModels),this.registry.concat(this.implicitThroughModels)},t.generateSchemaSpec=function(){return{tables:this.getModelClasses().reduce((e,t)=>{const n=t.modelName,r=t._getTableOpts();return Object.keys(r).forEach(e=>{if((e=>Ge.includes(e))(e))throw new Error(`Reserved keyword \`${e}\` used in ${n}.options.`)}),e[n]=Object.assign({},{fields:t.fields},r),e},{})}},t.getDatabase=function(){return this.db||(this.db=this.createDatabase(this.generateSchemaSpec())),this.db},t.getEmptyState=function(){return this.getDatabase().getEmptyState()},t.session=function(e){return new ae(this,this.getDatabase(),e)},t.mutableSession=function(e){return new ae(this,this.getDatabase(),e,!0)},t._setupModelPrototypes=function(e){e.forEach(e=>{if(!e.isSetUp){const{fields:t,modelName:n,querySetClass:r}=e;Object.entries(t).forEach(([t,r])=>{this._isFieldInstalled(n,t)||(this._installField(r,t,e),this._setFieldInstalled(n,t))}),ee(e,r),e.isSetUp=!0}})},t._isFieldInstalled=function(e,t){return!!this.installedFields.hasOwnProperty(e)&&!!this.installedFields[e][t]},t._setFieldInstalled=function(e,t){this.installedFields.hasOwnProperty(e)||(this.installedFields[e]={}),this.installedFields[e][t]=!0},t._installField=function(e,t,n){new(0,e.installerClass)({field:e,fieldName:t,model:n,orm:this}).run()},t.withMutations=function(e){return H("`ORM.prototype.withMutations` has been deprecated. Use `ORM.prototype.mutableSession` instead."),this.mutableSession(e)},t.from=function(e){return H("`ORM.prototype.from` has been deprecated. Use `ORM.prototype.session` instead."),this.session(e)},t.reducer=function(){return H("`ORM.prototype.reducer` has been deprecated. Access the `Session.prototype.state` property instead."),Ye(this)},t.createSelector=function(...e){return H("`ORM.prototype.createSelector` has been deprecated. Import `createSelector` from Redux-ORM instead."),ze(this,...e)},t.getDefaultState=function(){return H("`ORM.prototype.getDefaultState` has been deprecated. Use `ORM.prototype.getEmptyState` instead."),this.getEmptyState()},t.define=function(){throw new Error("`ORM.prototype.define` has been removed. Please define a Model class.")},e}();n.d(t,"Schema",function(){return Je}),n.d(t,"Backend",function(){return We}),n.d(t,"Attribute",function(){return pe}),n.d(t,"QuerySet",function(){return ie}),n.d(t,"Model",function(){return Se}),n.d(t,"ORM",function(){return Ke}),n.d(t,"Session",function(){return ae}),n.d(t,"ForeignKey",function(){return ye}),n.d(t,"ManyToMany",function(){return ge}),n.d(t,"OneToOne",function(){return be}),n.d(t,"fk",function(){return ve}),n.d(t,"many",function(){return Me}),n.d(t,"attr",function(){return we}),n.d(t,"oneToOne",function(){return Oe}),n.d(t,"createReducer",function(){return Ye}),n.d(t,"createSelector",function(){return ze});const Je=function(){throw new Error("Schema has been renamed to ORM. Please import ORM instead of Schema from Redux-ORM.")},We=function(){throw new Error("Having a custom Backend instance is now unsupported. Documentation for database customization is upcoming, for now please look at the db folder in the source.")};t.default=Se}])});
//# sourceMappingURL=redux-orm.min.js.map